<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KitchenHelper-AI - Dashboard</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/main.css">
</head>
<body>
    <div class="dashboard">
        <!-- Header -->
        <header class="header">
            <div class="container">
                <div class="header-content">
                    <div class="logo">ğŸ³ KitchenHelper-AI</div>
                    <div class="header-actions">
                        <div id="active-profiles" class="active-profiles-badge">
                            <!-- Wird dynamisch befÃ¼llt -->
                        </div>
                        <!-- Language Dropdown -->
                        <div class="lang-menu">
                            <button class="lang-toggle header-lang-toggle" onclick="i18n.toggleDropdown(event)" title="Sprache / Language">
                                <span class="lang-icon">ğŸŒ</span>
                                <span class="lang-toggle-text">DE</span>
                            </button>

                            <div class="lang-dropdown" id="lang-dropdown">
                                <button class="lang-option" onclick="i18n.setLanguage('de')">ğŸ‡©ğŸ‡ª Deutsch</button>
                                <button class="lang-option" onclick="i18n.setLanguage('en')">ğŸ‡¬ğŸ‡§ English</button>
                                <button class="lang-option" onclick="i18n.setLanguage('fr')">ğŸ‡«ğŸ‡· FranÃ§ais</button>
                                <button class="lang-option" onclick="i18n.setLanguage('es')">ğŸ‡ªğŸ‡¸ EspaÃ±ol</button>
                                <button class="lang-option" onclick="i18n.setLanguage('it')">ğŸ‡®ğŸ‡¹ Italiano</button>
                                <button class="lang-option" onclick="i18n.setLanguage('pt')">ğŸ‡µğŸ‡¹ PortuguÃªs</button>
                                <button class="lang-option" onclick="i18n.setLanguage('sv')">ğŸ‡¸ğŸ‡ª Svenska</button>
                                <button class="lang-option" onclick="i18n.setLanguage('no')">ğŸ‡³ğŸ‡´ Norsk</button>
                                <button class="lang-option" onclick="i18n.setLanguage('da')">ğŸ‡©ğŸ‡° Dansk</button>
                                <button class="lang-option" onclick="i18n.setLanguage('nl')">ğŸ‡³ğŸ‡± Nederlands</button>
                            </div>
                        </div>

                        <!-- Theme Dropdown -->
                        <div class="theme-menu">
                            <button class="theme-toggle" onclick="ThemeMenu.toggle(event)" aria-label="Farbschema wÃ¤hlen" title="Farbschema">
                                <span class="theme-icon">ğŸŒ™</span>
                            </button>

                            <div class="theme-dropdown" id="theme-dropdown">
                                <div class="theme-dropdown-grid">
                                    <!-- Light Modes -->
                                    <button class="theme-dot-btn" data-theme="light" onclick="ThemeMenu.setTheme('light')" title="Hell">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸŒ</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #4CAF50"></div>
                                            <div class="theme-dot" style="background: #2196F3"></div>
                                        </div>
                                    </button>
                                    <button class="theme-dot-btn" data-theme="sepia" onclick="ThemeMenu.setTheme('sepia')" title="Sepia">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸ“œ</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #8B7355"></div>
                                            <div class="theme-dot" style="background: #7B8B8E"></div>
                                        </div>
                                    </button>
                                    <button class="theme-dot-btn" data-theme="ocean-light" onclick="ThemeMenu.setTheme('ocean-light')" title="Ozean Hell">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸŒŠ</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #0891B2"></div>
                                            <div class="theme-dot" style="background: #3B82F6"></div>
                                        </div>
                                    </button>
                                    <button class="theme-dot-btn" data-theme="forest-light" onclick="ThemeMenu.setTheme('forest-light')" title="Wald Hell">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸŒ²</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #059669"></div>
                                            <div class="theme-dot" style="background: #16A34A"></div>
                                        </div>
                                    </button>
                                    <button class="theme-dot-btn" data-theme="sunset-light" onclick="ThemeMenu.setTheme('sunset-light')" title="Sonnenuntergang Hell">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸŒ…</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #F97316"></div>
                                            <div class="theme-dot" style="background: #EC4899"></div>
                                        </div>
                                    </button>

                                    <!-- Dark Modes -->
                                    <button class="theme-dot-btn" data-theme="dark" onclick="ThemeMenu.setTheme('dark')" title="Dunkel">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸŒ™</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #66BB6A"></div>
                                            <div class="theme-dot" style="background: #42A5F5"></div>
                                        </div>
                                    </button>
                                    <button class="theme-dot-btn" data-theme="nord" onclick="ThemeMenu.setTheme('nord')" title="Nord">
                                        <span style="font-size: 14px; margin-right: 4px;">â„ï¸</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #88C0D0"></div>
                                            <div class="theme-dot" style="background: #81A1C1"></div>
                                        </div>
                                    </button>
                                    <button class="theme-dot-btn" data-theme="solarized" onclick="ThemeMenu.setTheme('solarized')" title="Solarized">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸŒƒ</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #268BD2"></div>
                                            <div class="theme-dot" style="background: #2AA198"></div>
                                        </div>
                                    </button>
                                    <button class="theme-dot-btn" data-theme="dracula" onclick="ThemeMenu.setTheme('dracula')" title="Dracula">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸ§›</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #BD93F9"></div>
                                            <div class="theme-dot" style="background: #8BE9FD"></div>
                                        </div>
                                    </button>
                                    <button class="theme-dot-btn" data-theme="ocean-dark" onclick="ThemeMenu.setTheme('ocean-dark')" title="Ozean Dunkel">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸŒŠ</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #06B6D4"></div>
                                            <div class="theme-dot" style="background: #60A5FA"></div>
                                        </div>
                                    </button>
                                    <button class="theme-dot-btn" data-theme="forest-dark" onclick="ThemeMenu.setTheme('forest-dark')" title="Wald Dunkel">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸŒ²</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #10B981"></div>
                                            <div class="theme-dot" style="background: #22C55E"></div>
                                        </div>
                                    </button>
                                    <button class="theme-dot-btn" data-theme="sunset-dark" onclick="ThemeMenu.setTheme('sunset-dark')" title="Sonnenuntergang Dunkel">
                                        <span style="font-size: 14px; margin-right: 4px;">ğŸŒ†</span>
                                        <div class="theme-dot-double">
                                            <div class="theme-dot" style="background: #FB923C"></div>
                                            <div class="theme-dot" style="background: #F472B6"></div>
                                        </div>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- User Menu mit Emoji + Dropdown -->
                        <div class="user-menu">
                            <button class="user-avatar" onclick="UserMenu.toggle(event)">
                                <span class="user-emoji" id="user-emoji">ğŸ‘¤</span>
                                <span class="user-tier-badge" id="user-tier">Demo</span>
                            </button>

                            <div class="user-dropdown" id="user-dropdown">
                                <div class="dropdown-header">
                                    <strong id="dropdown-name">User</strong>
                                    <span id="dropdown-email">email@test.de</span>
                                </div>
                                <hr>
                                <button onclick="UserMenu.goToProModel()" data-i18n="nav.pro_model">ğŸ’ Pro Model</button>
                                <button onclick="UserMenu.goToProfiles()" data-i18n="nav.profiles">ğŸ‘¤ PrÃ¤ferenzen</button>
                                <button onclick="UserMenu.goToSettings()" data-i18n="nav.settings">âš™ï¸ Settings</button>
                                <hr>
                                <button onclick="Auth.logout()" data-i18n="auth.logout">ğŸšª Logout</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <div class="container">
                <!-- Navigation Tabs (Profile/Settings accessible via dropdown menu) -->
                <nav class="tabs nav-tabs">
                    <button class="tab active" data-section="ingredients" data-i18n="nav.ingredients">Ingredients</button>
                    <button class="tab" data-section="recipes" data-i18n="nav.recipes">Recipes</button>
                    <button class="tab" data-section="scanner" data-i18n="nav.scanner">Scanner</button>
                    <button class="tab" data-section="favorites" data-i18n="nav.favorites">Favorites</button>
                </nav>

                <!-- Sections -->
                <!-- Ingredients Section -->
                <section id="ingredients-section" class="section active">
                    <div class="page-header">
                        <h1 class="page-title" data-i18n="ingredients.title">ğŸ¥— My Ingredients</h1>
                        <div class="page-header-actions">
                            <button class="btn btn-outline" onclick="Ingredients.showSpiceQuickSelect()">âš¡ <span data-i18n="ingredients.spices">GewÃ¼rze</span></button>
                            <button class="btn btn-primary" onclick="Ingredients.showAddModal()" data-i18n="ingredients.add">+ Add Ingredient</button>
                        </div>
                    </div>
                    <div class="filters" style="margin-bottom: var(--spacing-lg);">
                        <select id="ingredient-category-filter" class="form-control" style="max-width: 200px;" onchange="Ingredients.load()">
                            <option value="" data-i18n="ingredients.all_categories">All Categories</option>
                        </select>
                    </div>
                    <div id="ingredients-list" class="grid grid-3"></div>
                </section>

                <!-- Recipes Section -->
                <section id="recipes-section" class="section">
                    <div class="page-header">
                        <h1 class="page-title" data-i18n="recipes.title">ğŸ½ï¸ Generate Recipes</h1>
                        <div class="page-header-actions">
                            <label class="toggle" style="font-size: 14px;">
                                <input type="checkbox" id="strict-ingredients-toggle" onchange="Recipes.toggleStrictMode(this.checked)">
                                <span class="toggle-slider"></span>
                                <span data-i18n="recipes.only_available">Nur vorhandene Zutaten</span>
                            </label>
                        </div>
                    </div>

                    <!-- Ingredient Selection -->
                    <div class="ingredient-selection card">
                        <h3 class="ingredient-selection-title" data-i18n="recipes.select_ingredients">Select your ingredients</h3>
                        <div id="ingredient-checkboxes" class="ingredient-checkboxes"></div>
                        <div style="margin-top: var(--spacing-lg); display: flex; gap: var(--spacing-md); flex-wrap: wrap; align-items: center;">
                            <button class="btn btn-primary btn-lg" onclick="Recipes.generate()" id="generate-btn">
                                ğŸ¤– <span data-i18n="recipes.generate">Generate Recipes</span>
                            </button>
                            <span id="selected-count" style="color: var(--text-muted);">0 <span data-i18n="recipes.selected">ingredients selected</span></span>
                        </div>
                    </div>

                    <!-- Generated Recipes -->
                    <h2 style="margin: var(--spacing-xl) 0 var(--spacing-lg);" data-i18n="recipes.generated">Generated Recipes</h2>
                    <div id="recipes-list" class="grid grid-2"></div>

                    <!-- Recipe History -->
                    <h2 style="margin: var(--spacing-xl) 0 var(--spacing-lg);" data-i18n="recipes.history">Recent Recipes</h2>
                    <div id="recipe-history" class="grid grid-2"></div>
                </section>

                <!-- Scanner Section -->
                <section id="scanner-section" class="section">
                    <div class="page-header">
                        <h1 class="page-title" data-i18n="scanner.title">ğŸ“¸ Food Scanner</h1>
                    </div>

                    <!-- Scanner Mode Tabs -->
                    <div class="scanner-mode-tabs" style="margin-bottom: var(--spacing-lg);">
                        <button class="scanner-mode-tab active" id="scanner-mode-barcode" data-i18n="scanner.mode_barcode">
                            ğŸ“· Barcode Scanner
                        </button>
                        <button class="scanner-mode-tab" id="scanner-mode-ocr" data-i18n="scanner.mode_ocr">
                            ğŸ“ OCR (Ingredients List)
                        </button>
                    </div>

                    <!-- Barcode Scanner Section -->
                    <div id="barcode-section" class="scanner-mode-section">
                        <div class="card">
                            <h3 data-i18n="scanner.barcode_title">Scan Product Barcode</h3>
                            <p style="color: var(--text-muted); margin-bottom: var(--spacing-lg);" data-i18n="scanner.barcode_hint">
                                Point your camera at a product barcode to get ingredient information
                            </p>

                            <!-- Scanner Reader -->
                            <div id="scanner-reader" style="width: 100%; max-width: 500px; margin: 0 auto;"></div>

                            <!-- Scanner Controls -->
                            <div class="scanner-controls" style="margin-top: var(--spacing-lg); text-align: center;">
                                <button id="scanner-start" class="btn btn-primary" data-i18n="scanner.start_scan">
                                    ğŸ“· Start Scan
                                </button>
                                <button id="scanner-stop" class="btn btn-danger" style="display: none;" data-i18n="scanner.stop_scan">
                                    â¹ï¸ Stop Scan
                                </button>
                            </div>

                            <!-- Scanner Result -->
                            <div id="scanner-result" style="margin-top: var(--spacing-lg); display: none;"></div>
                        </div>
                    </div>

                    <!-- OCR Scanner Section -->
                    <div id="ocr-section" class="scanner-mode-section" style="display: none;">
                        <div class="card">
                            <h3 data-i18n="scanner.ocr_title">Scan Ingredient List</h3>
                            <p style="color: var(--text-muted); margin-bottom: var(--spacing-lg);" data-i18n="scanner.ocr_hint">
                                Take a photo of ingredient lists on packaging to extract them
                            </p>

                            <!-- OCR Video Preview -->
                            <div style="position: relative; width: 100%; max-width: 500px; margin: 0 auto;">
                                <video id="ocr-video" autoplay playsinline style="width: 100%; border-radius: var(--border-radius);"></video>
                                <button id="ocr-capture" class="btn btn-primary" style="display: none; margin-top: var(--spacing-md);" onclick="Scanner.captureOCRImage()" data-i18n="scanner.capture">
                                    ğŸ“¸ Capture
                                </button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Favorites Section -->
                <section id="favorites-section" class="section">
                    <div class="page-header">
                        <h1 class="page-title" data-i18n="favorites.title">â­ My Favorites</h1>
                    </div>
                    <div class="search-bar" style="margin-bottom: var(--spacing-lg);">
                        <input type="text" id="favorites-search" class="form-control" placeholder="Search favorites..." data-i18n-placeholder="favorites.search_placeholder" oninput="Favorites.search(this.value)">
                    </div>
                    <div id="favorites-list" class="grid grid-2"></div>
                </section>

                <!-- Profiles Section (accessible via dropdown menu) -->
                <section id="profiles-section" class="section">
                    <div class="page-header">
                        <h1 class="page-title" data-i18n="profiles.title">ğŸ‘¤ Diet Profiles</h1>
                    </div>
                    <div id="profiles-list"></div>
                </section>

                <!-- Settings Section (accessible via dropdown menu) -->
                <section id="settings-section" class="section">
                    <div class="page-header">
                        <h1 class="page-title" data-i18n="settings.title">âš™ï¸ Settings</h1>
                    </div>

                    <div class="settings-section">
                        <h2 class="settings-title" data-i18n="settings.profile">Edit Profile</h2>
                        <form id="settings-form">
                            <div class="form-group">
                                <label class="form-label" data-i18n="settings.avatar_emoji">Avatar Emoji</label>
                                <div class="emoji-picker-container">
                                    <input type="text" id="settings-emoji" class="form-control emoji-input" placeholder="ğŸ‘¤" maxlength="2">
                                    <div class="emoji-suggestions">
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ‘¤')">ğŸ‘¤</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ‘¨')">ğŸ‘¨</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ‘©')">ğŸ‘©</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ§‘')">ğŸ§‘</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ‘¨â€ğŸ³')">ğŸ‘¨â€ğŸ³</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ‘©â€ğŸ³')">ğŸ‘©â€ğŸ³</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ³')">ğŸ³</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ¥—')">ğŸ¥—</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ•')">ğŸ•</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ˜Š')">ğŸ˜Š</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸŒŸ')">ğŸŒŸ</button>
                                        <button type="button" class="emoji-btn" onclick="Settings.setEmoji('ğŸ”¥')">ğŸ”¥</button>
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="auth.username">Username</label>
                                <input type="text" id="settings-username" class="form-control" placeholder="myusername" minlength="3" maxlength="20">
                                <small class="form-hint" data-i18n="auth.username_hint">3-20 characters, letters, numbers, - and _ only</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="auth.email">Email</label>
                                <input type="email" id="settings-email" class="form-control" placeholder="your@email.com">
                            </div>
                            <button type="submit" class="btn btn-primary" data-i18n="common.save">Save</button>
                        </form>
                    </div>


                    <div class="settings-section">
                        <h2 class="settings-title" data-i18n="settings.change_password">Change Password</h2>
                        <form id="password-form">
                            <div class="form-group">
                                <label class="form-label" data-i18n="settings.new_password">New Password</label>
                                <div class="password-input-wrapper">
                                    <input type="password" id="settings-password" class="form-control" placeholder="Min. 6 characters" minlength="6">
                                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('settings-password', this)">ğŸ‘ï¸</button>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label" data-i18n="settings.confirm_password">Confirm Password</label>
                                <div class="password-input-wrapper">
                                    <input type="password" id="settings-password-confirm" class="form-control" placeholder="Repeat password">
                                    <button type="button" class="password-toggle" onclick="togglePasswordVisibility('settings-password-confirm', this)">ğŸ‘ï¸</button>
                                </div>
                            </div>
                            <button type="submit" class="btn btn-primary" data-i18n="settings.change_password">Change Password</button>
                        </form>
                    </div>

                    <div class="settings-section">
                        <h2 class="settings-title" data-i18n="settings.account_info">Account Info</h2>
                        <div id="account-info"></div>
                    </div>

                    <div class="settings-section" style="border-left: 4px solid var(--danger);">
                        <h2 class="settings-title" style="color: var(--danger);" data-i18n="settings.danger_zone">âš ï¸ Danger Zone</h2>
                        <p style="margin-bottom: var(--spacing-md); color: var(--text-muted);" data-i18n="settings.danger_warning">
                            Warning: This action cannot be undone!
                        </p>
                        <button class="btn btn-danger" onclick="Settings.deleteAccount()" data-i18n="settings.delete_account">Delete Account</button>
                    </div>
                </section>

                <!-- Pro Model Section -->
                <section id="pro-model-section" class="section">
                    <div class="page-header">
                        <h1 class="page-title">ğŸ’ <span data-i18n="pro.title">Pro Model Features</span></h1>
                    </div>

                    <div class="card" style="max-width: 800px; margin: 0 auto;">
                        <h2 data-i18n="pro.what_is_pro">Was ist KitchenHelper-AI Pro?</h2>
                        <p style="margin-bottom: var(--spacing-lg); color: var(--text-muted);" data-i18n="pro.description">
                            Upgrade to Pro and unlock advanced AI features with better recipe quality and more personalization.
                        </p>

                        <div style="display: grid; gap: var(--spacing-md);">
                            <!-- Free Tier -->
                            <div style="padding: var(--spacing-md); border: 2px solid var(--border); border-radius: var(--border-radius);">
                                <h3>ğŸ†“ <span data-i18n="pro.free_tier">Free Tier</span></h3>
                                <ul style="list-style: none; padding: 0; margin-top: var(--spacing-md);">
                                    <li>âœ… <span data-i18n="pro.free_basic_recipes">Basic recipe generation</span></li>
                                    <li>âœ… <span data-i18n="pro.free_ingredients">Ingredient management</span></li>
                                    <li>âœ… <span data-i18n="pro.free_profiles">Up to 3 dietary profiles</span></li>
                                    <li>âœ… <span data-i18n="pro.free_favorites">Favorite recipes</span></li>
                                    <li>âš ï¸ <span data-i18n="pro.free_model">Uses: llama3.2:3b (smaller model)</span></li>
                                    <li>âš ï¸ <span data-i18n="pro.free_limit">Limited daily requests</span></li>
                                </ul>
                            </div>

                            <!-- Pro Tier -->
                            <div style="padding: var(--spacing-md); border: 3px solid var(--primary); border-radius: var(--border-radius); background: linear-gradient(135deg, rgba(87, 103, 255, 0.1), rgba(87, 103, 255, 0.05));">
                                <h3>ğŸ’ <span data-i18n="pro.pro_tier">Pro Tier</span></h3>
                                <ul style="list-style: none; padding: 0; margin-top: var(--spacing-md);">
                                    <li>âœ¨ <span data-i18n="pro.pro_advanced">Advanced recipe generation</span></li>
                                    <li>âœ¨ <span data-i18n="pro.pro_model">Uses: llama3.3:70b (premium model)</span></li>
                                    <li>âœ¨ <span data-i18n="pro.pro_quality">Better recipe quality & creativity</span></li>
                                    <li>âœ¨ <span data-i18n="pro.pro_unlimited">Unlimited daily requests</span></li>
                                    <li>âœ¨ <span data-i18n="pro.pro_profiles">Unlimited dietary profiles</span></li>
                                    <li>âœ¨ <span data-i18n="pro.pro_priority">Priority support</span></li>
                                    <li>âœ¨ <span data-i18n="pro.pro_encryption">End-to-end data encryption</span></li>
                                </ul>

                                <div style="margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--border);">
                                    <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: var(--spacing-md);">
                                        <div>
                                            <div style="font-size: 2em; font-weight: 700; color: var(--primary);">â‚¬4.99<span style="font-size: 0.5em; font-weight: 400;">/Monat</span></div>
                                            <div style="color: var(--text-muted); font-size: 0.9em;" data-i18n="pro.cancel_anytime">Jederzeit kÃ¼ndbar</div>
                                        </div>
                                        <button class="btn btn-primary btn-lg" onclick="ProModel.subscribe()" id="pro-subscribe-btn">
                                            ğŸ’ <span data-i18n="pro.upgrade_now">Jetzt upgraden</span>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Current Status -->
                            <div id="pro-status" style="padding: var(--spacing-md); background: var(--bg-secondary); border-radius: var(--border-radius); text-align: center;">
                                <div style="font-size: 0.9em; color: var(--text-muted);">
                                    <span data-i18n="pro.current_tier">Aktueller Plan:</span>
                                    <strong id="current-tier-display" style="color: var(--primary);">Free</strong>
                                </div>
                            </div>
                        </div>

                        <div style="margin-top: var(--spacing-lg); padding-top: var(--spacing-lg); border-top: 1px solid var(--border);">
                            <h3 data-i18n="pro.faq">HÃ¤ufige Fragen</h3>
                            <details style="margin-top: var(--spacing-md);">
                                <summary style="cursor: pointer; font-weight: 600;" data-i18n="pro.faq_payment">Welche Zahlungsmethoden werden akzeptiert?</summary>
                                <p style="margin-top: var(--spacing-sm); color: var(--text-muted);" data-i18n="pro.faq_payment_answer">
                                    Wir akzeptieren Kreditkarten, PayPal und SEPA-Lastschrift.
                                </p>
                            </details>
                            <details style="margin-top: var(--spacing-sm);">
                                <summary style="cursor: pointer; font-weight: 600;" data-i18n="pro.faq_cancel">Kann ich jederzeit kÃ¼ndigen?</summary>
                                <p style="margin-top: var(--spacing-sm); color: var(--text-muted);" data-i18n="pro.faq_cancel_answer">
                                    Ja, du kannst dein Abo jederzeit in den Einstellungen kÃ¼ndigen. Es lÃ¤uft bis zum Ende des bezahlten Zeitraums.
                                </p>
                            </details>
                            <details style="margin-top: var(--spacing-sm);">
                                <summary style="cursor: pointer; font-weight: 600;" data-i18n="pro.faq_difference">Was ist der Unterschied zwischen den Modellen?</summary>
                                <p style="margin-top: var(--spacing-sm); color: var(--text-muted);" data-i18n="pro.faq_difference_answer">
                                    Das Pro-Modell (llama3.3:70b) ist deutlich grÃ¶ÃŸer und intelligenter. Es erstellt kreativere Rezepte, berÃ¼cksichtigt PrÃ¤ferenzen besser und liefert detailliertere Anweisungen.
                                </p>
                            </details>
                        </div>
                    </div>
                </section>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/ingredients.js"></script>
    <script src="js/recipes.js"></script>
    <script src="js/scanner.js"></script>
    <script src="js/favorites.js"></script>
    <script src="js/profiles.js"></script>
    <script src="js/pro-model.js"></script>
    <script src="js/user-menu.js"></script>
    <script>
        // ==================== THEME MENU ====================
        const ThemeMenu = {
            init() {
                // Load saved theme
                const savedTheme = localStorage.getItem('colorTheme') || 'light';
                this.setTheme(savedTheme, false);

                // Close dropdown when clicking outside
                document.addEventListener('click', (e) => {
                    if (!e.target.closest('.theme-menu')) {
                        this.close();
                    }
                });

                // Update active theme dot
                this.updateActiveDot(savedTheme);
            },

            toggle(event) {
                event.stopPropagation();
                const dropdown = document.getElementById('theme-dropdown');
                dropdown.classList.toggle('show');
            },

            close() {
                const dropdown = document.getElementById('theme-dropdown');
                dropdown.classList.remove('show');
            },

            setTheme(theme, showMessage = true) {
                // Set theme on document
                document.documentElement.setAttribute('data-theme', theme);
                localStorage.setItem('colorTheme', theme);

                // Update theme icon based on theme
                const icon = document.querySelector('.theme-icon');
                if (icon) {
                    const themeIcons = {
                        'light': 'ğŸŒ',
                        'sepia': 'ğŸ“œ',
                        'ocean-light': 'ğŸŒŠ',
                        'forest-light': 'ğŸŒ²',
                        'sunset-light': 'ğŸŒ…',
                        'dark': 'ğŸŒ™',
                        'nord': 'â„ï¸',
                        'solarized': 'ğŸŒƒ',
                        'dracula': 'ğŸ§›',
                        'ocean-dark': 'ğŸŒŠ',
                        'forest-dark': 'ğŸŒ²',
                        'sunset-dark': 'ğŸŒ†'
                    };
                    icon.textContent = themeIcons[theme] || 'ğŸŒ™';
                }

                // Update active dot
                this.updateActiveDot(theme);

                // Don't close dropdown - keep it open
                // this.close();

                // Success message
                if (showMessage) {
                    const themeName = i18n.translate(`settings.theme_${theme}`);
                    const msg = i18n.currentLang === 'de'
                        ? `Farbschema "${themeName}" aktiviert!`
                        : `Color scheme "${themeName}" activated!`;
                    UI.success(msg);
                }

                console.log('[ThemeMenu] Set to:', theme);
            },

            updateActiveDot(theme) {
                // Remove active state from all dots
                document.querySelectorAll('.theme-dot-btn').forEach(btn => {
                    btn.removeAttribute('data-theme-active');
                });

                // Add active state to current theme
                const activeBtn = document.querySelector(`.theme-dot-btn[data-theme="${theme}"]`);
                if (activeBtn) {
                    activeBtn.setAttribute('data-theme-active', 'true');
                }
            }
        };

        // Require authentication
        if (!Auth.requireAuth()) {
            // Will redirect to login
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', () => {
            ThemeMenu.init();
            initDashboard();
        });

        async function initDashboard() {
            // Load saved theme
            Settings.loadTheme();

            // Load user info
            const user = Auth.getCurrentUser();
            if (user) {
                // Update User Menu
                UserMenu.updateUserInfo(user);
            }

            // Setup navigation
            setupNavigation();

            // Load initial data
            await Ingredients.load();

            // Load profiles for active badge
            await Profiles.load();

            // Setup settings form
            setupSettingsForm();
        }

        function setupNavigation() {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    // Update tabs
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    // Update sections
                    document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
                    document.getElementById(`${tab.dataset.section}-section`).classList.add('active');

                    // Load section data
                    loadSectionData(tab.dataset.section);
                });
            });
        }

        async function loadSectionData(section) {
            switch (section) {
                case 'ingredients':
                    await Ingredients.load();
                    break;
                case 'recipes':
                    await Recipes.loadIngredientSelection();
                    await Recipes.loadHistory();
                    Recipes.loadStrictMode();
                    break;
                case 'scanner':
                    await Scanner.init();
                    break;
                case 'favorites':
                    await Favorites.load();
                    break;
                case 'profiles':
                    await Profiles.load();
                    break;
                case 'settings':
                    loadSettingsData();
                    break;
            }
        }

        function setupSettingsForm() {
            // Profile form
            document.getElementById('settings-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const username = document.getElementById('settings-username').value.trim();
                const email = document.getElementById('settings-email').value.trim();
                const emoji = document.getElementById('settings-emoji').value;

                // Validate username
                if (username && (username.length < 3 || !/^[a-zA-Z0-9_-]+$/.test(username))) {
                    UI.error(i18n.t('error.username_invalid'));
                    return;
                }

                try {
                    const data = {};
                    if (username) data.username = username;
                    if (email) data.email = email;
                    if (emoji) data.emoji = emoji;

                    if (Object.keys(data).length > 0) {
                        await Auth.updateProfile(data);
                        UI.success(i18n.currentLang === 'de' ? 'Profil aktualisiert!' : 'Profile updated!');

                        // Update User Menu
                        const user = Auth.getCurrentUser();
                        UserMenu.updateUserInfo(user);
                    }
                } catch (error) {
                    UI.error(error.message);
                }
            });

            // Password form
            document.getElementById('password-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const password = document.getElementById('settings-password').value;
                const confirm = document.getElementById('settings-password-confirm').value;

                if (password !== confirm) {
                    UI.error(i18n.t('error.passwords_not_match'));
                    return;
                }

                if (password.length < 6) {
                    UI.error(i18n.t('error.password_too_short'));
                    return;
                }

                try {
                    await Auth.updateProfile({ password });
                    UI.success(i18n.currentLang === 'de' ? 'Passwort geÃ¤ndert!' : 'Password changed!');
                    document.getElementById('password-form').reset();
                } catch (error) {
                    UI.error(error.message);
                }
            });
        }

        function loadSettingsData() {
            const user = Auth.getCurrentUser();
            if (user) {
                document.getElementById('settings-username').value = user.username || '';
                document.getElementById('settings-email').value = user.email || '';
                document.getElementById('settings-emoji').value = user.emoji || 'ğŸ‘¤';

                const tierInfo = Auth.getTierInfo();
                const lang = i18n.currentLang;
                const labels = lang === 'de'
                    ? { username: 'Benutzername', email: 'E-Mail', subscription: 'Abonnement', recipes: 'Rezepte heute', member: 'Mitglied seit' }
                    : { username: 'Username', email: 'Email', subscription: 'Subscription', recipes: 'Recipes today', member: 'Member since' };

                document.getElementById('account-info').innerHTML = `
                    <p><strong>${labels.username}:</strong> ${user.username}</p>
                    <p><strong>${labels.email}:</strong> ${user.email}</p>
                    <p><strong>${labels.subscription}:</strong> ${tierInfo.name}</p>
                    <p><strong>${labels.recipes}:</strong> ${user.daily_recipe_count} / ${user.daily_limit}</p>
                    <p><strong>${labels.member}:</strong> ${UI.formatDate(user.created_at)}</p>
                `;
            }
        }

        // Settings module
        const Settings = {
            setEmoji(emoji) {
                document.getElementById('settings-emoji').value = emoji;
            },

            async saveEmoji() {
                const emoji = document.getElementById('settings-emoji').value || 'ğŸ‘¤';
                try {
                    await Auth.updateProfile({ emoji });
                    UserMenu.updateUserInfo(Auth.getCurrentUser());
                    UI.success(i18n.currentLang === 'de' ? 'Emoji aktualisiert!' : 'Emoji updated!');
                } catch (error) {
                    UI.error(error.message);
                }
            },

            setTheme(theme, showMessage = true) {
                // Use ThemeMenu to set the theme
                ThemeMenu.setTheme(theme, showMessage);

                // Update settings UI
                this.updateThemeUI(theme);
            },

            loadTheme() {
                // Load theme from localStorage, default to 'light'
                const savedTheme = localStorage.getItem('colorTheme') || 'light';
                // Theme is already loaded by ThemeMenu.init(), just update the settings UI
                this.updateThemeUI(savedTheme);
            },

            updateThemeUI(theme) {
                // Update active state on theme cards in settings
                document.querySelectorAll('.theme-card').forEach(card => {
                    if (card.getAttribute('data-theme') === theme) {
                        card.setAttribute('data-theme-active', 'true');
                    } else {
                        card.removeAttribute('data-theme-active');
                    }
                });
            },

            deleteAccount() {
                const msg = i18n.currentLang === 'de'
                    ? 'Bist du sicher? Dein Account und alle Daten werden unwiderruflich gelÃ¶scht!'
                    : 'Are you sure? Your account and all data will be permanently deleted!';
                UI.confirm(msg, async () => {
                    try {
                        await api.deleteMe();
                        Auth.logout();
                    } catch (error) {
                        UI.error(error.message);
                    }
                });
            }
        };
    </script>

    <!-- Footer mit Impressum-Link -->
    <footer style="position: fixed; bottom: 0; width: 100%; text-align: center; padding: 10px; background: var(--bg); border-top: 1px solid var(--border); font-size: 12px; color: var(--text-secondary); z-index: 100;">
        <a href="impressum.html" style="color: var(--primary); text-decoration: none; margin: 0 10px;">Impressum</a>
        <span style="margin: 0 5px;">Â·</span>
        <span>Â© 2025 Melucio-Labs</span>
    </footer>
</body>
</html>
